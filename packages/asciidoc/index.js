import"astro/loaders";import{z as e}from"astro/zod";import{loadConfig as M}from"c12";import Z from"fast-glob";import{bundledLanguages as U,createHighlighter as K,bundledThemes as Y}from"shiki";import G from"slugify";import R from"prismjs";import V from"prismjs/components/index.js";import J from"asciidoctor";var L=e.function().args(e.string()).returns(e.promise(e.array(e.string()))).implement(async i=>Z("**/*.{adoc,asciidoc}",{cwd:i})),P=e.function(e.tuple([e.string(),e.record(e.string(),e.union([e.string(),e.number(),e.boolean()]))]),e.string()),X=e.object({author:e.string().regex(/[A-Z][a-z]+\s+[A-Z][a-z]+/,"The author's name must be a name and last name both capitalized with a space in between").optional(),email:e.string().email(),backend:e.string(),filetype:e.boolean(),localdir:e.string(),localdate:e.string().date(),localdatetime:e.string().datetime(),localtime:e.string().time(),localyear:e.number().int(),attributeMissing:e.enum(["drop","drop-line","skip","warn"]),attributeUndefined:e.enum(["drop","drop-line"]),experimental:e.boolean(),appendixCaption:e.string(),appendixNumber:e.string(),appendixRefsig:e.string(),cautionCaption:e.string(),cautionNumber:e.string(),cautionRefsig:e.string(),cautionSignifier:e.string(),exampleCaption:e.string(),exampleNumber:e.string(),figureCaption:e.string(),figureNumber:e.number(),footnoteNumber:e.number(),importantCaption:e.string(),lastUpdateLabel:e.string(),listingCaption:e.string(),listingNumber:e.number(),noteCaption:e.string(),partRefsig:e.string(),partSignifier:e.string(),prefaceTitle:e.string(),tableCaption:e.string(),tableNumber:e.string(),tipCaption:e.string(),tocTitle:e.string(),untitledLabel:e.string(),warningCaption:e.string(),appName:e.string(),idprefix:e.string(),idseparator:e.string(),leveloffset:e.enum(["0","1","2","3","4","5"]).transform(i=>parseInt(i)),partnums:e.boolean(),setanchors:e.boolean(),sectids:e.boolean(),sectlinks:e.boolean(),sectnums:e.boolean(),sectnumlevels:e.enum(["0","1","2","3","4","5"]).transform(i=>parseInt(i)),titleSeparator:e.string(),toc:e.enum(["auto","left","right","macro","preamble"]).or(e.literal(!0)),toclevels:e.enum(["1","2","3","4","5"]).transform(i=>parseInt(i)),fragment:e.boolean(),stylesheet:e.string()}).partial(),F=Object.keys(Y),_=e.enum([F[0],...F.slice(1)]),Q=e.enum(["markup","css","clike","javascript","abap","actionscript","ada","apacheconf","apl","applescript","arduino","arff","asciidoc","asm6502","aspnet","autohotkey","autoit","bash","basic","batch","bison","brainfuck","bro","c","csharp","cpp","coffeescript","clojure","crystal","csp","css-extras","d","dart","diff","django","docker","eiffel","elixir","elm","erb","erlang","fsharp","flow","fortran","gedcom","gherkin","git","glsl","gml","go","graphql","groovy","haml","handlebars","haskell","haxe","http","hpkp","hsts","ichigojam","icon","inform7","ini","io","j","java","jolie","json","julia","keyman","kotlin","latex","less","liquid","lisp","livescript","lolcode","lua","makefile","markdown","markup-templating","matlab","mel","mizar","monkey","n4js","nasm","nginx","nim","nix","nsis","objectivec","ocaml","opencl","oz","parigp","parser","pascal","perl","php","php-extras","plsql","plaintext","powershell","processing","prolog","properties","protobuf","pug","puppet","pure","python","q","qore","r","jsx","tsx","renpy","reason","rest","rip","roboconf","ruby","rust","sas","sass","scss","scala","scheme","smalltalk","smarty","sql","soy","stylus","swift","tap","tcl","textile","tt2","twig","typescript","vbnet","velocity","verilog","vhdl","vim","visual-basic","wasm","wiki","xeora","xojo","xquery","yaml"]).array(),ee=e.object({sourceHighlighter:e.literal("prism").optional(),prismLanguages:Q.optional().default(["markup","css","javascript","typescript","markdown","yaml","json","jsx","tsx","asciidoc","bash","php","git"])}),te=e.object({sourceHighlighter:e.literal("shiki").optional(),shikiTheme:e.object({light:_,dark:_,dim:_.optional()}).refine(({light:i,dark:t})=>i!==t,{path:["shikiTheme.dark","shikiTheme.light"],message:"The light theme and dark theme must be different from each other"}).superRefine(({light:i,dark:t,dim:o},r)=>{i===o&&r.addIssue({path:["shikiTheme.light","shikiTheme.dim"],code:"custom",message:"The light theme must not be equal to the light theme"}),t===o&&r.addIssue({path:["shikiTheme.dark","shikiTheme.dim"],code:"custom",message:"The light theme must not be equal to the light theme"})}).optional()}),ie=e.object({attributes:e.union([ee,te]).and(X).optional().default({sourceHighlighter:"shiki",shikiTheme:{dark:"github-light",light:"github-dark",dim:"github-dark-dimmed"}}),blocks:e.record(e.string(),e.object({context:e.enum(["example","listing","literal","pass","quote","sidebar"]),render:P})).optional(),macros:e.object({inline:e.record(e.string(),e.object({context:e.enum(["quoted","anchor"]),render:P})).optional(),block:e.record(e.string(),e.object({context:e.enum(["example","listing","literal","pass","quote","sidebar"]),render:P})).optional()}).optional()}).strict(),D=async i=>{let{config:t,configFile:o}=await M({cwd:i,name:"asciidoc",omit$Keys:!0});return Object.keys(t).length===0?t:(e.string().regex(/asciidoc.config.m(?:ts|js)/,"The asciidoc config file must be a mts or mjs file").parse(o),ie.parse(t))},T=class i{#e=J();static#t;#i;constructor(){if(i.#t)return i.#t;i.#t=this}registerPrism_JS(t){V(t),this.#e.SyntaxHighlighter.register("prism",{initialize(o,r,s){this.$$name="prism",this.super(o,r,s)},format(o,r){return`<pre class="${this.$$name} language-${r}">${o.getContent()}</pre>`},handlesHighlighting:()=>!0,highlight(o,r,s="plaintext"){return R.highlight(r,R.languages[s],s)}})}async registerShiki(t){this.#i=this.#i&&await K({themes:t.dim?[t.light,t.dark,t.dim]:[t.light,t.dark],langs:Object.keys(U)});let o=this.#i;this.#e.SyntaxHighlighter.register("shiki",{initialize(r,s,l){this.super(r,s,l),this.$$name="shiki"},handlesHighlighting:()=>!0,highlight(r,s,l){return o?.codeToHtml(s,{lang:l,cssVariablePrefix:"--faa-shiki-",defaultColor:"light",themes:t})}})}registerBlocksAndMacrosFromConfig=(t,o)=>{this.#e.Extensions.register(function(){if(t)for(let[r,{context:s,render:l}]of Object.entries(t))this.block(r,function(){this.process(function(f,a,p){return this.createBlock(f,s,l(a.getString(),p),p)})});if(o?.inline)for(let[r,{context:s,render:l}]of Object.entries(o.inline))this.inlineMacro(r,function(){this.process(function(f,a,p){return this.createInline(f,s,l(a,p))})});if(o?.block)for(let[r,{context:s,render:l}]of Object.entries(o.block))this.blockMacro(r,function(){this.process(function(f,a,p){return this.createBlock(f,s,l(a,p),p)})})})};loadFileWithAttributes(t,o){return this.#e.loadFile(t,{attributes:o&&Object.fromEntries(Object.entries(o).map(([s,l])=>[r(s),l])),safe:10,catalog_assets:!0});function r(s){return s.replace(/[A-Z]/g,l=>`-${l.toLowerCase()}`)}}},j=i=>G(i,{lower:!0,trim:!0,remove:/[*+~.()'"!:@]/g});import{z as x}from"astro/zod";var re=/^(?:[a-zA-Z0-9_-]+,\s*|[a-zA-Z0-9_-]+(?:,\s+[a-zA-Z0-9_-]+)+,?)$/;function se(i){let t={};for(let[o,r]of Object.entries(i)){let s=o.replace(/[-_]([a-z])/g,(l,f)=>f.toUpperCase());if(r===""){t[s]=!0;continue}if(typeof r=="string"&&re.test(r)){t[s]=r.split(",").map(l=>l.trim()).filter(Boolean);continue}t[s]=r}return t}var C=class{constructor(t,o){this.pathRelativeToRoot=t;this.slug=o}},m;function xe(i){let t=new T;return{name:"forastro/asciidoc-loader",async load(o){x.string().regex(/\w+(?:\/\w+)*/,`A content folder name must be a string with word characters at the front only.
   Ex: content
   When referring to deeply nested folders in the project make sure you place a forward slash
   before each folder name after the parent folder name.
   Ex: src/content

   No spaces or special characters.
   `).parse(i);let{store:s,config:l,generateDigest:f,logger:a,collection:p,parseData:H,watcher:E}=o;a.info("Loading Asciidoc paths and config file");let $=l.root.pathname;m=m??await D($);let N=await L(`${$}/${i}/${p}`);switch(m.attributes?.sourceHighlighter){case"shiki":m.attributes?.shikiTheme?await t.registerShiki(m.attributes.shikiTheme):a.error('Shiki theme not configured when sourceHighlighter is "shiki".');break;case"prism":"prismLanguages"in m.attributes?t.registerPrism_JS(m.attributes.prismLanguages):a.error('Prism languages not configured when sourceHighlighter is "prism".');break}Object.keys(m).length!==0&&(a.info("Creating Asciidoc Registry from using config file"),t.registerBlocksAndMacrosFromConfig(m.blocks,m.macros)),a.info("Clearing the store"),s.clear(),a.info("Extracting data from files then storing it");let y=new Map,A=/(?<filename>[\w\s\d-]+)(?<extension>\.[a-z]+)$/;for(let n of N){let w=n.match(A);if(!w)throw Error(`This path isn't correct.
                         A folder can use any set of characters but must end in a forward slash.
                         A filename must use word characters digits and whitespace no other characters.
                        `);let h=w.groups?.filename??"";if(!h)throw Error("There should be a word called filename in the word group");let c=`${i}/${p}/${n}`,b=t.loadFileWithAttributes(`${$}/${c}`,m.attributes),g=j(h);await z(c,g,b),y.set(h,new C(c,g))}let O=[".adoc",".asciidoc"];E?.on("add",async n=>{if(!O.some(k=>n.endsWith(k)))return;let h=n.match(A);if(!h)throw Error(`This path ${n} isn't correct.
                         A folder can use any set of characters but must end in a forward slash.
                         A filename must use word characters digits and whitespace no other characters.
                        `);a.info(`You added this file ${n} it's info will be now parsed an added to the store`);let c=h.groups?.filename??"";if(!c)throw Error("There should be a word called filename in the word group");let g=((k,W)=>{let B=W.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),q=new RegExp(`${B}.*`),I=k.match(q);if(!I)throw Error("Please place the values in the right place don't change any params");return I[0]})(n,i),S=t.loadFileWithAttributes(n,m?.attributes),d=j(c);await z(d,g,S),y.set(c,new C(g,d)),a.info(`Finished adding the file now you can go to /${d} depending on your route to access it.`)}),E?.on("change",async n=>{if(!O.some(g=>n.endsWith(g)))return;let h=n.match(A)?.[1]??"";a.info(`You changed this file ${h} the store is being updated`);let c=y.get(h);if(!c)throw Error(`A slug is supposed to exist using this file name ${h}.
                        Some thing is wrong with the loader please file a report
                        `);s.delete(c.slug);let b=t.loadFileWithAttributes(n,m?.attributes);await z(c.pathRelativeToRoot,c.slug,b),a.info("The store is updated")}),E?.on("unlink",n=>{if(!O.some(g=>n.endsWith(g)))return;let h=n.match(A);if(!h)throw Error(`This path isn't correct.
                         A folder can use any set of characters but must end in a forward slash.
                         A filename must use word characters digits and whitespace no other characters.
                        `);let c=h.groups?.filename??"";if(!c)throw Error("There should be a word called filename in the word group");a.info(`You deleted this file ${c}`);let b=y.get(c);if(!b)throw Error(`A slug is supposed to exist using this file name ${c}.
                        Some thing is wrong with the loader please file a report.
                        From unlink event using this path ${n}.
                        `);s.delete(b.slug),a.info("The store has now been updated!"),a.info("Finished")});async function z(n,w,h){let c=x.union([x.string(),x.number(),x.boolean()]),b=x.record(x.string().regex(/^(?<first_word>(?:[a-z0-9]+))(?<other_words_in_snake_or_dash_case>(?:-[a-z0-9]+|_[a-z0-9]+)*)$/,"You must write using dash case Ex: url-repo"),c.or(c.array())),g;try{let d=h.getAttributes(),k=se(d);g=b.parse(k)}catch(d){if(d instanceof x.ZodError){a.error("All attributes must be written in dashed or snake case in files");for(let k of d.issues)a.error(`In this file ${n} this attribute ${k.path} has this problem ${k.message}`)}return}let S=await H({id:w,data:g,filePath:n});s.set({id:w,data:S,filePath:n,digest:f(g),rendered:{metadata:{frontmatter:S,imagePaths:h.getImages().map(d=>d.getTarget()),headings:h.getSections().map(d=>({text:d.getTitle()??"",depth:d.getLevel(),slug:j(d.getTitle()??"")}))},html:h.convert()}})}}}}import{z as u}from"astro/zod";var v=u.string().regex(/^(?<first_name>[A-Z][a-z.]+)\s+(?<middle_names>(?:[A-Z][a-z.]+\s)*)?(?<last_name>[A-Z][a-z]+)$/,"An author should have at least a first and last name both capitalized"),oe=u.object({doctitle:u.string().regex(/[\w\s\d]+/,"Please make sure your title is one with words letters and spaces"),docdate:u.string().date(),email:u.string().email(),localdate:u.string().date(),author:v,authors:u.union([v,v.array()]),createdAt:u.string().date(),description:u.string().min(35,"It's good for a description to at least be two sentences").max(160,"A title needs to be at least 160 characters max")}).transform(i=>{let{doctitle:t,docdate:o,...r}=i;return{title:t,updatedAt:o,...r}}),ae=u.enum(["draft","published","editing"]),Se=oe.and(u.object({stage:ae}));export{ae as ASCIIDOC_POST_STAGE,oe as asciidocBaseSchema,Se as asciidocDraftSchema,xe as asciidocLoader,se as normalizeAsciiDocAttributes};
