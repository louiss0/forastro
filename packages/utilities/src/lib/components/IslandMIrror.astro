---
type Props = {
  id: string;
  children: astroHTML.JSX.HTMLAttributes;
};
---

<slot />
<script define:vars={{ id }}>
  const element = document.body.querySelector(`#${id}`);

  const attrsMap = new Map();

  if (!element) {
    throw new Error(
      "This component must have an island with a data island key "
    );
  }

  if (element?.parentElement?.tagName !== "ASTRO-ISLAND") {
    throw new Error(
      "Please only use this component for islands don't use this for anything else"
    );
  }
  const attributeNames = element.getAttributeNames();

  if (attributeNames.length === 0) {
    throw new Error(
      "Please add attributes the the element you are using with IslandMirror"
    );
  }

  attributeNames.forEach((attrName) =>
    attrsMap.set(attrName, element.getAttribute(attrName))
  );

  attrsMap.forEach((value, key) => {
    element.parentElement?.setAttribute(key, value);
  });

  element.parentElement.replaceChildren(...Array.from(element.childNodes));
</script>
